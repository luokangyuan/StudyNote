# 正则表达式简介

正则表达式（regular expression）描述了一种字符串匹配的模式，可以用来：（1）检查一个串中是否含有符合某个规则的子串，并且可以得到这个子串；（2）根据匹配规则对字符串进行灵活的替换操作。

# 正则表达式规则

## 普通字符

字母、数字、汉字、下划线、以及没有特殊定义的标点符号，都是"普通字符"。表达式中的普通字符，在匹配一个字符串的时候，匹配与之相同的一个字符。

**例如**

| 表达式 | 匹配字符串 | 匹配结果 | 匹配得到内容 | 匹配开始位置 | 结束位置 |
| :----: | :--------: | :------: | :----------: | :----------: | :------: |
|  “c”   |   "gfgc"   |   成功   |     "c"      |      3       |    3     |
| "bcd"  |  "abcde"   |   成功   |    "bcd"     |      1       |    4     |

## 简单的转义字符

一些不便书写的字符，采用在前面加 "/" 的方法，还有其他一些有特殊用处的标点符号，在前面加"/" 后，就代表该符号本身。比如：^,  都有特殊意义，如果要想匹配字符串中 "^" 和 "" 字符，则表达式就需要写成 "/^" 和 "/$"。

**例如**

| 表达式 |      可匹配      |
| :----: | :--------------: |
| /r，/n | 代表回车和换行符 |
|   /t   |      制表符      |
|   //   |   代表“/”本身    |
|   /^   |  匹配^符号本身   |
|   /$   |  匹配$符号本身   |
|   /.   |  匹配小数点本身  |

## 能够与多种字符匹配的表达式

正则表达式中的一些表示方法，可以匹配 '多种字符' 其中的任意一个字符。比如，表达式 "/d" 可以匹配任意一个数字。虽然可以匹配其中任意字符，**但是只能是一个，不是多个**

| 表达式 | 可匹配                                                       |
| :----: | :----------------------------------------------------------- |
|   /d   | 任意一个数字，0~9 中的任意一个                               |
|   /w   | 任意一个字母或数字或下划线，也就是A~Z,a~z,0~9,_ 中任意一个   |
|   /s   | 包括空格、制表符、换页符等空白字符的其中任意一个小数点可以匹配除了换行符（/n）以外的任意一个字符 |

**例如**

表达式 "/d/d"，在匹配 "abc123" 时，匹配的结果是：成功；匹配到的内容是："12"；匹配到的位置是：开始于3，结束于5。

表达式 "a./d"，在匹配 "aaa100" 时，匹配的结果是：成功；匹配到的内容是："aa1"；匹配到的位置是：开始于1，结束于4。

## 自定义能够匹配多种字符的表达式

使用方括号 [ ] 包含一系列字符，能够匹配其中任意一个字符。用 `[^ ]`包含一系列字符，则能够匹配其中字符之外的任意一个字符。同样的道理，虽然可以匹配其中任意一个，**但是只能是一个，不是多个。**

| 表达式    | 可匹配                                  |
| --------- | --------------------------------------- |
| [ab5@]    | 匹配 "a" 或 "b" 或 "5" 或 "@"           |
| [^abc]    | 匹配 "a","b","c" 之外的任意一个字符     |
| [f-k]     | 匹配 "f"~"k" 之间的任意一个字母         |
| [^A-F0-3] | 匹配 "A"~"F","0"~"3" 之外的任意一个字符 |

**例如**

表达式 `"[bcd][bcd]" `匹配 "abc123" 时，匹配的结果是：成功；匹配到的内容是："bc"；匹配到的位置是：开始于1，结束于3。

表达式` "[^abc]" `匹配 "abc123" 时，匹配的结果是：成功；匹配到的内容是："1"；匹配到的位置是：开始于3，结束于4。

## 修饰匹配次数的特殊符号

前面讲到的表达式，无论是只能匹配一种字符的表达式，还是可以匹配多种字符其中任意一个的表达式，都只能匹配一次。如果使用表达式再加上修饰匹配次数的特殊符号，那么不用重复书写表达式就可以重复匹配。

**使用方法**

"次数修饰"放在"被修饰的表达式"后边。比如：`"[bcd][bcd]" `可以写成 "[bcd]{2}"。

| 表达式 | 作用                                                         |
| ------ | ------------------------------------------------------------ |
| {n}    | 表达式重复n 次，比如："/w{2}" 相当于 "/w/w"；"a{5}" 相当于 "aaaaa" |
| {m,n}  | 表达式至少重复m 次，最多重复n 次，比如："ba{1,3}"可以匹配 "ba"或"baa"或"baaa" |
| {m,}   | 表达式至少重复m 次，比如："/w/d{2,}"可以匹配"a12","_456","M12344"... |
| ?      | 匹配表达式0 次或者1 次，相当于 {0,1}，比如："a[cd]?"可以匹配 "a","ac","ad" |
| +      | 表达式至少出现1 次，相当于 {1,}，比如："a+b"可以匹配 "ab","aab","aaab"... |
| *      | 表达式不出现或出现任意次，相当于 {0,}，比如："/^*b"可以匹配 "b","^^^b"... |

**例如**

表达式 "/d+/.?/d*" 在匹配 "It costs $12.5" 时，匹配的结果是：成功；匹配到的内容是："12.5"；匹配到的位置是：开始于10，结束于14。

表达式 "go{2,8}gle" 在匹配 "Ads by goooooogle" 时，匹配的结果是：成功；匹配到的内容是："goooooogle"；匹配到的位置是：开始于7，结束于17。

## 代表抽象意义的特殊符号

一些符号在表达式中代表抽象的特殊意义

| 表达式 | 作用                                                         |
| :----: | ------------------------------------------------------------ |
|   ^    | 与字符串开始的地方匹配，不匹配任何字符                       |
|   $    | 与字符串结束的地方匹配，不匹配任何字符                       |
|   /b   | 匹配一个单词边界，也就是单词和空格之间的位置，不匹配任何字符 |

**例如**

表达式 "^aaa" 在匹配 "xxx aaa xxx" 时，匹配结果是：失败。因为 "^" 要求与字符串开始的地方匹配，因此，只有当 "aaa" 位于字符串的开头的时候，"^aaa" 才能匹配，比如："aaa xxx xxx"。

表达式 `"aaa$" `在匹配` "xxx aaa xxx" `时，匹配结果是：失败。因为 `"$" `要求与字符串结束的地方匹配，因此，只有当 `"aaa" `位于字符串的结尾的时候，`"aaa$" `才能匹配，比如：`"xxx xxx aaa"。`

表达式 "./b." 在匹配 "@@@abc" 时，匹配结果是：成功；匹配到的内容是："@a"；匹配到的位置是：开始于2，结束于4。

表达式之间的符号

| 表达式 | 作用                                                         |
| :----: | ------------------------------------------------------------ |
|   \|   | 左右两边表达式之间 "或" 关系，匹配左边或者右边               |
|  ( )   | (1). 在被修饰匹配次数的时候，括号中的表达式可以作为整体被修饰<br />(2). 取匹配结果的时候，括号中的表达式匹配到的内容可以被单独得到 |

**例如**

表达式 "Tom|Jack" 在匹配字符串 "I'm Tom, he is Jack"时，匹配结果是：成功；匹配到的内容是："Tom"；匹配到的位置是：开始于4，结束于7。匹配下一个时，匹配结果是：成功；匹配到的内容是："Jack"；匹配到的位置时：开始于15，结束于19。

表达式 "(go/s*)+" 在匹配 "Let's go go go!" 时，匹配结果是：成功；匹配到内容是："go go go"；匹配到的位置是：开始于6，结束于14。

表达式 "￥(/d+/.?/d*)" 在匹配 "＄10.9,￥20.5" 时，匹配的结果是：成功；匹配到的内容是："￥20.5"；匹配到的位置是：开始于6，结束于10。单独获取括号范围匹配到的内容是："20.5"

# 正则表达式中的高级规则

## 匹配次数中的贪婪和非贪婪

在使用修饰匹配次数的特殊符号时，有几种表示方法可以使同一个表达式能够匹配不同的次数，比如："{m,n}", "{m,}", "?", "*","+"，具体匹配的次数随被匹配的字符串而定。这种重复匹配不定次数的表达式在匹配过程中，总是尽可能多的匹配。比如，针对文本"dxxxdxxxd"，如下：

| 表达式      | 匹配结果                                                     |
| ----------- | ------------------------------------------------------------ |
| (d)(/w+)    | "/w+" 将匹配第一个 "d" 之后的所有字符"xxxdxxxd"              |
| (d)(/w+)(d) | "/w+" 将匹配第一个 "d" 和最后一个 "d" 之间的所有字符 "xxxdxxx"。虽然 "/w+" 也能够匹配上最后一个 "d"，但是为了使整个表达式匹配成功，"/w+" 可以 "让出" 它本来能够匹配的最后一个 "d" |

由此可见，"/w+" 在匹配的时候，总是尽可能多的匹配符合它规则的字符。虽然第二个举例中，它没有匹配最后一个 "d"，但那也是为了让整个表达式能够匹配成功。同理，带 "*" 和 "{m,n}" 的表达式都是尽可能地多匹配，带 "?" 的表达式在可匹配可不匹配的时候，也是尽可能的 "要匹配"。这 种匹配原则就叫作 "贪婪" 模式 。

**非贪婪模式**

在修饰匹配次数的特殊符号后再加上一个 "?" 号，则可以使匹配次数不定的表达式尽可能少的匹配，使可匹配可不匹配的表达式，尽可能的 "不匹配"。这种匹配原则叫作 "非贪婪" 模式，也叫作 "勉强"模式。如果少匹配就会导致整个表达式匹配失败的时候，与贪婪模式类似，非贪婪模式会最小限度的再匹配一些，以使整个表达式匹配成功。如下，针对文本 "dxxxdxxxd" 举例：

| 表达式       | 匹配结果                                                     |
| ------------ | ------------------------------------------------------------ |
| (d)(/w+?)    | "/w+?" 将尽可能少的匹配第一个 "d" 之后的字符结果是："/w+?" 只匹配了一个 "x" |
| (d)(/w+?)(d) | 为了让整个表达式匹配成功，"/w+?" 不得不匹配 "xxx" 才可以让后边的 "d" 匹配，从而使整个表达式匹配成功。因此，结果是："/w+?" 匹配 "xxx" |

**例如**

表达式 `"<td>(.*)</td>" `与字符串 `"<td><p>aa</p></td><td><p>bb</p></td>" `匹配时，匹配的结果是：成功；匹配到的内容是 `"<td><p>aa</p></td> <td><p>bb</p></td>" `整个字符串， 表达式中的 `"</td>" `将与字符串中最后一个` "</td>" `匹配。

相比之下，表达式` "<td>(.*?)</td>" `匹配举例1 中同样的字符串时，将只得到 `"<td><p>aa</p></td>"， `再次匹配下一个时，可以得到第二个 `"<td><p>bb</p></td>"。`

## 反向引用/1, /2...

表达式在匹配时，表达式引擎会将小括号 "( )" 包含的表达式所匹配到的字符串记录下来。在获取匹配结果的时候，小括号包含的表达式所匹配到的字符串可以单独获取。这一点，在前面的举例中，已经多次展示了。在实际应用场合中，当用某种边界来查找，而所要获取的内容又不包含边界时，必须使用小括号来指定所要的范围。比如前面的` "<td>(.*?)</td>"。`

其实，"小括号包含的表达式所匹配到的字符串" 不仅是在匹配结束后才可以使用，在匹配过程中也可以使用。表达式后边的部分，可以引用前面 "括号内的子匹配已经匹配到的字符串"。引用方法是"/" 加上一个数字。"/1" 引用第1 对括号内匹配到的字符串，"/2" 引用第2 对括号内匹配到的字符串……以此类推，如果一对括号内包含另一对括号，则外层的括号先排序号。换句话说，哪一对的左括号"(" 在前，那这一对就先排序号。

**例如**

表达式 "('|")(.*?)(/1)" 在匹配 " 'Hello', "World" " 时，匹配结果是：成功；匹配到的内容是：" 'Hello' "。再次匹配下一个时，可以匹配到 " "World" "

表达式 "(/w)/1{4,}" 在匹配 "aa bbbb abcdefg ccccc111121111 999999999" 时，匹配结果是：成功；匹配到的内容是"ccccc"。再次匹配下一个时，将得到 999999999。这个表达式要求"/w" 范围的字符至少重复5 次，注意与 "/w{5,}" 之间的区别。

表达式 "<(/w+)/s*(/w+(=('|").*?/4)?/s*)*>.*?<//1>" 在匹配`"<td id='td1' style="bgcolor:white"></td>" `时，匹配结果是成功。如果`"<td>" `与 `"</td>" `不配对，则会匹配失败；如果改成其他配对，也可以匹配成功。

## 预搜索和反向预搜索

前面的章节中，我讲到了几个代表抽象意义的特殊符号："^"，"$"，"/b"。它们都有一个共同点，那就是：它们本身不匹配任何字符，只是对 "字符串的两头" 或者 "字符之间的缝隙" 附加了一个条件。理解到这个概念以后，本节将继续介绍另外一种对 "两头" 或者 "缝隙" 附加条件的，更加灵活的表示方法。

正向预搜索："(?=xxxxx)"，"(?!xxxxx)"

格式："(?=xxxxx)"，在被匹配的字符串中，它对所处的 "缝隙" 或者 "两头" 附加的条件是：所在缝隙的右侧，必须能够匹配上 xxxxx这部分的表达式。因为它只是在此作为这个缝隙上附加的条件，所以它并不影响后边的表达式去真正匹配这个缝隙之后的字符。这就类似 "/b"，本身不匹配任何字符。"/b" 只是将所在缝隙之前、之后的字符取来进行了一下判断，不会影响后边的表达式来真正的匹配。

**例如**

表达式 "Windows (?=NT|XP)" 在匹配 "Windows 98,Windows NT, Windows 2000" 时，将只匹配 "Windows NT" 中的"Windows "，其他的 "Windows " 字样则不被匹配。

# 常用正则表达式

## 校验数字的表达式

```properties
数字：^[0-9]*$
n位的数字：^\d{n}$
至少n位的数字：^\d{n,}$
m-n位的数字：^\d{m,n}$
零和非零开头的数字：^(0|[1-9][0-9]*)$
非零开头的最多带两位小数的数字：^([1-9][0-9]*)+(\.[0-9]{1,2})?$
带1-2位小数的正数或负数：^(\-)?\d+(\.\d{1,2})$
正数、负数、和小数：^(\-|\+)?\d+(\.\d+)?$
有两位小数的正实数：^[0-9]+(\.[0-9]{2})?$
有1~3位小数的正实数：^[0-9]+(\.[0-9]{1,3})?$
非零的正整数：^[1-9]\d*$ 或 ^([1-9][0-9]*){1,3}$ 或 ^\+?[1-9][0-9]*$
非零的负整数：^\-[1-9][]0-9"*$ 或 ^-[1-9]\d*$
非负整数：^\d+$ 或 ^[1-9]\d*|0$
非正整数：^-[1-9]\d*|0$ 或 ^((-\d+)|(0+))$
非负浮点数：^\d+(\.\d+)?$ 或 ^[1-9]\d*\.\d*|0\.\d*[1-9]\d*|0?\.0+|0$
非正浮点数：^((-\d+(\.\d+)?)|(0+(\.0+)?))$ 或 ^(-([1-9]\d*\.\d*|0\.\d*[1-9]\d*))|0?\.0+|0$
正浮点数：^[1-9]\d*\.\d*|0\.\d*[1-9]\d*$ 或 ^(([0-9]+\.[0-9]*[1-9][0-9]*)|([0-9]*[1-9][0-9]*\.[0-9]+)|([0-9]*[1-9][0-9]*))$
负浮点数：^-([1-9]\d*\.\d*|0\.\d*[1-9]\d*)$ 或 ^(-(([0-9]+\.[0-9]*[1-9][0-9]*)|([0-9]*[1-9][0-9]*\.[0-9]+)|([0-9]*[1-9][0-9]*)))$
浮点数：^(-?\d+)(\.\d+)?$ 或 ^-?([1-9]\d*\.\d*|0\.\d*[1-9]\d*|0?\.0+|0)$
```

## 校验字符的表达式

```properties
汉字：^[\u4e00-\u9fa5]{0,}$
英文和数字：^[A-Za-z0-9]+$ 或 ^[A-Za-z0-9]{4,40}$
长度为3-20的所有字符：^.{3,20}$
由26个英文字母组成的字符串：^[A-Za-z]+$
由26个大写英文字母组成的字符串：^[A-Z]+$
由26个小写英文字母组成的字符串：^[a-z]+$
由数字和26个英文字母组成的字符串：^[A-Za-z0-9]+$
由数字、26个英文字母或者下划线组成的字符串：^\w+$ 或 ^\w{3,20}$
中文、英文、数字包括下划线：^[\u4E00-\u9FA5A-Za-z0-9_]+$
中文、英文、数字但不包括下划线等符号：^[\u4E00-\u9FA5A-Za-z0-9]+$ 或 ^[\u4E00-\u9FA5A-Za-z0-9]{2,20}$
可以输入含有^%&',;=?$\"等字符：[^%&',;=?$\x22]+
禁止输入含有~的字符：[^~\x22]+
```

## 特殊校验表达式

```properties
Email地址：^\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*$
域名：[a-zA-Z0-9][-a-zA-Z0-9]{0,62}(/.[a-zA-Z0-9][-a-zA-Z0-9]{0,62})+/.?
InternetURL：[a-zA-z]+://[^\s]* 或 ^http://([\w-]+\.)+[\w-]+(/[\w-./?%&=]*)?$
手机号码：^(13[0-9]|14[5|7]|15[0|1|2|3|5|6|7|8|9]|18[0|1|2|3|5|6|7|8|9])\d{8}$
电话号码("XXX-XXXXXXX"、"XXXX-XXXXXXXX"、"XXX-XXXXXXX"、"XXX-XXXXXXXX"、"XXXXXXX"和"XXXXXXXX)：^(\(\d{3,4}-)|\d{3.4}-)?\d{7,8}$
国内电话号码(0511-4405222、021-87888822)：\d{3}-\d{8}|\d{4}-\d{7}
电话号码正则表达式（支持手机号码，3-4位区号，7-8位直播号码，1－4位分机号）: ((\d{11})|^((\d{7,8})|(\d{4}|\d{3})-(\d{7,8})|(\d{4}|\d{3})-(\d{7,8})-(\d{4}|\d{3}|\d{2}|\d{1})|(\d{7,8})-(\d{4}|\d{3}|\d{2}|\d{1}))$)
身份证号(15位、18位数字)，最后一位是校验位，可能为数字或字符X：(^\d{15}$)|(^\d{18}$)|(^\d{17}(\d|X|x)$)
帐号是否合法(字母开头，允许5-16字节，允许字母数字下划线)：^[a-zA-Z][a-zA-Z0-9_]{4,15}$
密码(以字母开头，长度在6~18之间，只能包含字母、数字和下划线)：^[a-zA-Z]\w{5,17}$
强密码(必须包含大小写字母和数字的组合，不能使用特殊字符，长度在8-10之间)：^(?=.*\d)(?=.*[a-z])(?=.*[A-Z]).{8,10}$
日期格式：^\d{4}-\d{1,2}-\d{1,2}
一年的12个月(01～09和1～12)：^(0?[1-9]|1[0-2])$
一个月的31天(01～09和1～31)：^((0?[1-9])|((1|2)[0-9])|30|31)$
xml文件：^([a-zA-Z]+-?)+[a-zA-Z0-9]+\\.[x|X][m|M][l|L]$
中文字符的正则表达式：[\u4e00-\u9fa5]
双字节字符：[^\x00-\xff] (包括汉字在内，可以用来计算字符串的长度(一个双字节字符长度计2，ASCII字符计1))
空白行的正则表达式：\n\s*\r (可以用来删除空白行)
HTML标记的正则表达式：<(\S*?)[^>]*>.*?|<.*? /> ( 首尾空白字符的正则表达式：^\s*|\s*$或(^\s*)|(\s*$) (可以用来删除行首行尾的空白字符(包括空格、制表符、换页符等等)，非常有用的表达式)
腾讯QQ号：[1-9][0-9]{4,} (腾讯QQ号从10000开始)
中国邮政编码：[1-9]\d{5}(?!\d) (中国邮政编码为6位数字)
IP地址：((?:(?:25[0-5]|2[0-4]\\d|[01]?\\d?\\d)\\.){3}(?:25[0-5]|2[0-4]\\d|[01]?\\d?\\d))
```

